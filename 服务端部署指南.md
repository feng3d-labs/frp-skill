# frp 服务端部署指南

在公网服务器 `li.feng3d.com` 上部署 frps，接收客户端连接并转发流量。

## 前提条件

- 一台具有公网 IP 的 Linux 服务器
- 域名 `li.feng3d.com` 已解析到该服务器 IP
- 拥有 root 或 sudo 权限

## 部署步骤

### 1. 下载 frp

```bash
VERSION=0.67.0
wget https://github.com/fatedier/frp/releases/download/v${VERSION}/frp_${VERSION}_linux_amd64.tar.gz
tar -xzf frp_${VERSION}_linux_amd64.tar.gz
sudo cp frp_${VERSION}_linux_amd64/frps /usr/local/bin/
rm -rf frp_${VERSION}_linux_amd64 frp_${VERSION}_linux_amd64.tar.gz
```

### 2. 创建配置文件

```bash
sudo mkdir -p /etc/frp
sudo tee /etc/frp/frps.toml > /dev/null <<'EOF'
bindPort = 7000
EOF
```

参数说明：
- `bindPort` — 监听端口，用于与 frpc 客户端通信

### 3. 开放防火墙端口

需要开放两个端口：
- **7000** — frp 客户端通信
- **12345** — 转发的服务端口

```bash
# firewalld
sudo firewall-cmd --add-port=7000/tcp --permanent
sudo firewall-cmd --add-port=12345/tcp --permanent
sudo firewall-cmd --reload

# 或 ufw
sudo ufw allow 7000/tcp
sudo ufw allow 12345/tcp

# 或 iptables
sudo iptables -A INPUT -p tcp --dport 7000 -j ACCEPT
sudo iptables -A INPUT -p tcp --dport 12345 -j ACCEPT
```

> 如果服务器有云厂商安全组（如阿里云、腾讯云），还需在安全组中放行这些端口。

### 4. 启动测试

```bash
frps -c /etc/frp/frps.toml
```

看到 `frps started successfully` 表示启动成功。

### 5. 配置为系统服务（开机自启）

```bash
sudo tee /etc/systemd/system/frps.service > /dev/null <<'EOF'
[Unit]
Description=frps service
After=network.target

[Service]
Type=simple
ExecStart=/usr/local/bin/frps -c /etc/frp/frps.toml
Restart=on-failure
RestartSec=5s

[Install]
WantedBy=multi-user.target
EOF

sudo systemctl daemon-reload
sudo systemctl enable frps
sudo systemctl start frps
```

常用管理命令：

```bash
sudo systemctl status frps    # 查看状态
sudo systemctl restart frps   # 重启
sudo systemctl stop frps      # 停止
journalctl -u frps -f         # 查看日志
```

## 验证

服务端启动后，在客户端机器运行 frpc 连接，然后浏览器访问 `http://li.feng3d.com:12345`。

## 常见问题

| 问题 | 解决方法 |
|------|----------|
| 客户端连不上服务端 | 检查防火墙/安全组是否开放 7000 端口 |
| 公网端口访问无响应 | 检查防火墙/安全组是否开放 remotePort |
| frps 启动失败 | 检查 7000 端口是否被占用：`ss -tlnp \| grep 7000` |
| 服务重启后断开 | 已配置 systemd 自动重启，客户端也会自动重连 |
